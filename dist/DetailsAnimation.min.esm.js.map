{"version":3,"sources":["DetailsAnimation.esm.js"],"names":["_preOpen","_animation","_supportCSSTypedOM","_summaryElement","_summaryToggleHTML","_detailsContentElement","_detailsContentCustomElementName","_detailsContentResizeObserver","_summaryClickEventListener","_summaryMouseEnterEventListener","_summaryMouseLeaveEventListener","_detailsContentTransitionEndEventListener","_windowResizeEventListener","_windowResizeTimeoutId","__classPrivateFieldSet","this","receiver","privateMap","value","has","TypeError","set","__classPrivateFieldGet","get","DetailsAnimation","HTMLDetailsElement","[object Object]","super","undefined","attributeStyleMap","_summaryClickEvent","bind","_summaryMouseEnterEvent","_summaryMouseLeaveEvent","_detailsContentTransitionEndEvent","_windowResizeEvent","summaryElement","querySelector","Error","window","tabIndex","open","getAttribute","detailsContentCustomElementName","dataset","contentElement","includes","summaryToggle","fragment","document","createDocumentFragment","nextNode","nextSibling","appendChild","detailsContentElement","createElement","insertAdjacentElement","slot","ResizeObserver","_detailContentResize","_open","observe","addEventListener","passive","_close","removeEventListener","ev","preventDefault","preOpen","_toggleSummary","summaryToggleHTML","innerHTML","textContent","insertAdjacentHTML","setTimeout","CSS","px","scrollHeight","style","height","String","unobserve","willChange","delete","timeoutId","clearTimeout","WeakMap"],"mappings":"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","file":"DetailsAnimation.esm.js","sourcesContent":["var __classPrivateFieldSet = (this && this.__classPrivateFieldSet) || function (receiver, privateMap, value) {\n    if (!privateMap.has(receiver)) {\n        throw new TypeError(\"attempted to set private field on non-instance\");\n    }\n    privateMap.set(receiver, value);\n    return value;\n};\nvar __classPrivateFieldGet = (this && this.__classPrivateFieldGet) || function (receiver, privateMap) {\n    if (!privateMap.has(receiver)) {\n        throw new TypeError(\"attempted to get private field on non-instance\");\n    }\n    return privateMap.get(receiver);\n};\nvar _preOpen, _animation, _supportCSSTypedOM, _summaryElement, _summaryToggleHTML, _detailsContentElement, _detailsContentCustomElementName, _detailsContentResizeObserver, _summaryClickEventListener, _summaryMouseEnterEventListener, _summaryMouseLeaveEventListener, _detailsContentTransitionEndEventListener, _windowResizeEventListener, _windowResizeTimeoutId;\n/**\n * Animate the opening or closing process of the <details> element by Custom Elements.\n *\n * @version 1.2.0\n */\nexport default class DetailsAnimation extends HTMLDetailsElement {\n    constructor() {\n        super();\n        _preOpen.set(this, false); // アニメーションの実現のため本来の open 属性の反映タイミングは実際とは変えており、開閉処理が始まった瞬間の状態をこの変数に記録する\n        _animation.set(this, false); // アニメーション中かどうか\n        _supportCSSTypedOM.set(this, void 0); // CSS Typed Object Model に対応しているか https://caniuse.com/mdn-api_element_attributestylemap\n        _summaryElement.set(this, null);\n        _summaryToggleHTML.set(this, void 0);\n        _detailsContentElement.set(this, null); // <details> 要素内の <summary> 要素を除くコンテンツを囲う要素\n        _detailsContentCustomElementName.set(this, 'x-details-animation-content'); // <details> 要素内の <summary> 要素を除くコンテンツを囲う要素の名前\n        _detailsContentResizeObserver.set(this, null);\n        _summaryClickEventListener.set(this, void 0);\n        _summaryMouseEnterEventListener.set(this, void 0);\n        _summaryMouseLeaveEventListener.set(this, void 0);\n        _detailsContentTransitionEndEventListener.set(this, void 0);\n        _windowResizeEventListener.set(this, void 0);\n        _windowResizeTimeoutId.set(this, null); // window.onresize のタイマーの識別 ID（clearTimeout() で使用）\n        __classPrivateFieldSet(this, _supportCSSTypedOM, this.attributeStyleMap !== undefined);\n        __classPrivateFieldSet(this, _summaryClickEventListener, this._summaryClickEvent.bind(this));\n        __classPrivateFieldSet(this, _summaryMouseEnterEventListener, this._summaryMouseEnterEvent.bind(this));\n        __classPrivateFieldSet(this, _summaryMouseLeaveEventListener, this._summaryMouseLeaveEvent.bind(this));\n        __classPrivateFieldSet(this, _detailsContentTransitionEndEventListener, this._detailsContentTransitionEndEvent.bind(this));\n        __classPrivateFieldSet(this, _windowResizeEventListener, this._windowResizeEvent.bind(this));\n    }\n    connectedCallback() {\n        const summaryElement = this.querySelector('summary');\n        if (summaryElement === null) {\n            throw new Error('Element <details> is missing a required instance of child element <summary>.');\n        }\n        __classPrivateFieldSet(this, _summaryElement, summaryElement);\n        if (window.HTMLDetailsElement === undefined) {\n            /* <details> 未対応ブラウザ */\n            summaryElement.tabIndex = 0;\n            this.open = this.getAttribute('open') !== null;\n        }\n        const detailsContentCustomElementName = this.dataset.contentElement;\n        if (detailsContentCustomElementName !== undefined) {\n            if (!detailsContentCustomElementName.includes('-')) {\n                throw new Error('Attribute: `data-content-element` value must contain a hyphen.');\n            }\n            __classPrivateFieldSet(this, _detailsContentCustomElementName, detailsContentCustomElementName);\n        }\n        __classPrivateFieldSet(this, _summaryToggleHTML, this.dataset.summaryToggle);\n        /* <summary> を除くノードを <div> でラップする */\n        const fragment = document.createDocumentFragment();\n        let nextNode = summaryElement.nextSibling;\n        while (nextNode !== null) {\n            fragment.appendChild(nextNode);\n            nextNode = summaryElement.nextSibling;\n        }\n        const detailsContentElement = document.createElement(__classPrivateFieldGet(this, _detailsContentCustomElementName));\n        summaryElement.insertAdjacentElement('afterend', detailsContentElement);\n        __classPrivateFieldSet(this, _detailsContentElement, detailsContentElement);\n        const contentElement = document.createElement('div');\n        contentElement.slot = 'content';\n        contentElement.appendChild(fragment);\n        detailsContentElement.appendChild(contentElement);\n        if (window.ResizeObserver !== undefined) {\n            __classPrivateFieldSet(this, _detailsContentResizeObserver, new ResizeObserver(() => {\n                this._detailContentResize();\n            }));\n        }\n        const open = this.open;\n        __classPrivateFieldSet(this, _preOpen, open);\n        if (open) {\n            this._open();\n            if (__classPrivateFieldGet(this, _detailsContentResizeObserver) !== null) {\n                __classPrivateFieldGet(this, _detailsContentResizeObserver).observe(detailsContentElement);\n            }\n            else {\n                window.addEventListener('resize', __classPrivateFieldGet(this, _windowResizeEventListener), { passive: true });\n            }\n        }\n        else {\n            this._close();\n        }\n        summaryElement.addEventListener('click', __classPrivateFieldGet(this, _summaryClickEventListener));\n        summaryElement.addEventListener('mouseenter', __classPrivateFieldGet(this, _summaryMouseEnterEventListener), { passive: true });\n        summaryElement.addEventListener('mouseleave', __classPrivateFieldGet(this, _summaryMouseLeaveEventListener), { passive: true });\n        detailsContentElement.addEventListener('transitionend', __classPrivateFieldGet(this, _detailsContentTransitionEndEventListener), { passive: true });\n    }\n    disconnectedCallback() {\n        const summaryElement = __classPrivateFieldGet(this, _summaryElement);\n        const detailsContentElement = __classPrivateFieldGet(this, _detailsContentElement);\n        summaryElement.removeEventListener('click', __classPrivateFieldGet(this, _summaryClickEventListener));\n        summaryElement.removeEventListener('mouseenter', __classPrivateFieldGet(this, _summaryMouseEnterEventListener));\n        summaryElement.removeEventListener('mouseleave', __classPrivateFieldGet(this, _summaryMouseLeaveEventListener));\n        detailsContentElement.removeEventListener('transitionend', __classPrivateFieldGet(this, _detailsContentTransitionEndEventListener));\n        window.removeEventListener('resize', __classPrivateFieldGet(this, _windowResizeEventListener));\n    }\n    /**\n     * <summary> 要素をクリックしたときの処理\n     *\n     * @param {Event} ev - Event\n     */\n    _summaryClickEvent(ev) {\n        ev.preventDefault();\n        const preOpen = !__classPrivateFieldGet(this, _preOpen);\n        __classPrivateFieldSet(this, _preOpen, preOpen);\n        this._toggleSummary();\n        if (!__classPrivateFieldGet(this, _animation) && preOpen) {\n            this.open = true;\n        }\n        if (preOpen) {\n            this._open();\n        }\n        else {\n            this._close();\n        }\n        __classPrivateFieldSet(this, _animation, true);\n    }\n    /**\n     * <summary> 要素の表示を切り替える\n     */\n    _toggleSummary() {\n        const summaryToggleHTML = __classPrivateFieldGet(this, _summaryToggleHTML);\n        if (summaryToggleHTML !== undefined) {\n            const summaryElement = __classPrivateFieldGet(this, _summaryElement);\n            __classPrivateFieldSet(this, _summaryToggleHTML, summaryElement.innerHTML);\n            summaryElement.textContent = '';\n            summaryElement.insertAdjacentHTML('beforeend', summaryToggleHTML);\n        }\n    }\n    /**\n     * コンテンツエリアを開く処理\n     */\n    _open() {\n        const detailsContentElement = __classPrivateFieldGet(this, _detailsContentElement);\n        setTimeout(() => {\n            if (__classPrivateFieldGet(this, _supportCSSTypedOM)) {\n                detailsContentElement.attributeStyleMap.set('height', CSS.px(detailsContentElement.scrollHeight));\n            }\n            else {\n                detailsContentElement.style.height = `${String(detailsContentElement.scrollHeight)}px`;\n            }\n        }, 0); // TODO 最初から open 状態の場合、初期状態では高さが正常に取得できないための回避策\n    }\n    /**\n     * コンテンツエリアを閉じる処理\n     */\n    _close() {\n        const detailsContentElement = __classPrivateFieldGet(this, _detailsContentElement);\n        if (__classPrivateFieldGet(this, _supportCSSTypedOM)) {\n            detailsContentElement.attributeStyleMap.set('height', '0');\n        }\n        else {\n            detailsContentElement.style.height = '0';\n        }\n        if (__classPrivateFieldGet(this, _detailsContentResizeObserver) !== null) {\n            __classPrivateFieldGet(this, _detailsContentResizeObserver).unobserve(detailsContentElement);\n        }\n        else {\n            window.removeEventListener('resize', __classPrivateFieldGet(this, _windowResizeEventListener));\n        }\n    }\n    /**\n     * <summary> 要素上にマウスカーソルが入ったときの処理\n     */\n    _summaryMouseEnterEvent() {\n        if (__classPrivateFieldGet(this, _supportCSSTypedOM)) {\n            __classPrivateFieldGet(this, _detailsContentElement).attributeStyleMap.set('will-change', 'height');\n        }\n        else {\n            __classPrivateFieldGet(this, _detailsContentElement).style.willChange = 'height';\n        }\n    }\n    /**\n     * <summary> 要素上からマウスカーソルが外れたときの処理\n     */\n    _summaryMouseLeaveEvent() {\n        if (__classPrivateFieldGet(this, _supportCSSTypedOM)) {\n            __classPrivateFieldGet(this, _detailsContentElement).attributeStyleMap.delete('will-change');\n        }\n        else {\n            __classPrivateFieldGet(this, _detailsContentElement).style.willChange = '';\n        }\n    }\n    /**\n     * 開閉アニメーションが終了したときの処理\n     */\n    _detailsContentTransitionEndEvent() {\n        __classPrivateFieldSet(this, _animation, false);\n        if (!__classPrivateFieldGet(this, _preOpen)) {\n            this.open = false;\n        }\n        else {\n            if (__classPrivateFieldGet(this, _detailsContentResizeObserver) !== null) {\n                __classPrivateFieldGet(this, _detailsContentResizeObserver).observe(__classPrivateFieldGet(this, _detailsContentElement));\n            }\n            else {\n                window.addEventListener('resize', __classPrivateFieldGet(this, _windowResizeEventListener), { passive: true });\n            }\n        }\n    }\n    /**\n     * ウィンドウサイズを変更した時の処理（ResizeObserver API 未対応ブラウザ）\n     */\n    _windowResizeEvent() {\n        const timeoutId = __classPrivateFieldGet(this, _windowResizeTimeoutId);\n        if (timeoutId !== null) {\n            clearTimeout(timeoutId);\n        }\n        __classPrivateFieldSet(this, _windowResizeTimeoutId, setTimeout(() => {\n            this._detailContentResize();\n        }, 100));\n    }\n    /**\n     * コンテンツエリアの矩形が変化した時の処理\n     */\n    _detailContentResize() {\n        const detailsContentElement = __classPrivateFieldGet(this, _detailsContentElement);\n        if (__classPrivateFieldGet(this, _supportCSSTypedOM)) {\n            detailsContentElement.attributeStyleMap.set('height', 'auto');\n            detailsContentElement.attributeStyleMap.set('height', CSS.px(detailsContentElement.scrollHeight));\n        }\n        else {\n            detailsContentElement.style.height = 'auto';\n            detailsContentElement.style.height = `${String(detailsContentElement.scrollHeight)}px`;\n        }\n    }\n}\n_preOpen = new WeakMap(), _animation = new WeakMap(), _supportCSSTypedOM = new WeakMap(), _summaryElement = new WeakMap(), _summaryToggleHTML = new WeakMap(), _detailsContentElement = new WeakMap(), _detailsContentCustomElementName = new WeakMap(), _detailsContentResizeObserver = new WeakMap(), _summaryClickEventListener = new WeakMap(), _summaryMouseEnterEventListener = new WeakMap(), _summaryMouseLeaveEventListener = new WeakMap(), _detailsContentTransitionEndEventListener = new WeakMap(), _windowResizeEventListener = new WeakMap(), _windowResizeTimeoutId = new WeakMap();\n"]}